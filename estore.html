<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="RanSan Groups eStore ‚Äì Best digital products and deals online. Limited-time offers!">
  <meta name="keywords" content="RanSan, eStore, digital products, best deals, offers">
  <meta name="author" content="RanSan Groups">
  <title>RanSan Groups eStore</title>
  <link rel="stylesheet" href="assets/estore/style.css">
  <link rel="stylesheet" href="assets/estore/popup.css">
  <link rel="stylesheet" href="assets/estore/offer-widget.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <link rel="icon" type="image/png" href="assets/estore/RanSan_Logo_small.png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="assets/config.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="assets/estore/combo-modern.js"></script>

  <script>
    const sheetId = getSheetId();  // ‚úÖ will now work
    const apiKey = getApiKey();
  </script>


  <link rel="stylesheet" href="assets/estore/flash-ticker.css" />
  <link rel="stylesheet" href="assets/estore/deals-of-the-day.css">

  <!-- Open Graph Meta (For Facebook, WhatsApp, LinkedIn) -->
  <meta property="og:title" content="RanSan Groups eStore ‚Äì Digital Deals & Offers" />
  <meta property="og:description"
    content="Explore premium digital products, instant delivery & limited-time discounts!" />
  <meta property="og:image" content="https://www.ransangroups.com/assets/estore/social-share.jpg" />
  <meta property="og:url" content="https://www.ransangroups.com/estore" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card Meta -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="RanSan Groups eStore ‚Äì Digital Deals & Offers" />
  <meta name="twitter:description" content="Shop the best digital products & save big at RanSan eStore." />
  <meta name="twitter:image" content="https://www.ransangroups.com/assets/estore/social-share.jpg" />




  <style>
    html {
      scroll-behavior: smooth;
    }


    .buy-btn {
      background: linear-gradient(to right, #9a22f6, #f96fdc);
      color: #fff;
      padding: 10px 20px;
      border-radius: 30px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    .buy-btn:hover {
      background: linear-gradient(45deg, #B833FF, #8224E3);
      transform: translateY(-2px);
      /* ‚úÖ Subtle hover effect */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    #order-processing-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-size: 22px;
      font-family: Poppins, sans-serif;
    }

    @media only screen and (max-width: 769px) {

      .purchase-alert,
      #recent-purchase-popup {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        height: 0 !important;
        margin: 0 !important;
        pointer-events: none !important;
      }
    }    
  </style>

</head>

<body>


  <!-- üîù Header Section -->
  <header class="site-header" id="main-header">
    <div class="header-wrapper">
      <div class="header-left">
        <img src="assets/estore/RanSan_Logo_small.png" class="logo" alt="RanSan Logo" />

        <!-- üëá Wrap title and tagline vertically -->
        <div class="site-text-group">
          <span class="site-title">RanSan eStore</span>
          <p class="site-tagline">Trusted Digital Store Since 2025</p>
        </div>
      </div>

      <div class="header-right">

        <!-- üéÅ Offer Toggle Button -->
        <button id="offersToggleBtn" class="offers-toggle-btn">üéÅ Deals</button>

        <button id="darkModeToggle" class="icon-btn">üåô</button>

        <button class="icon-btn" aria-label="Search" id="searchToggle">üîç</button>

        <div id="searchBox" style="display:none;">
          <input type="text" id="searchInput" placeholder="Search for products...">
        </div>

        <button class="icon-btn relative" aria-label="Cart">
          üõí<span class="cart-badge">3</span>
        </button>


      </div>
    </div>
  </header>




  <!-- Hero Section -->
  <div class="hero-wrapper">

    <section class="hero-combo">
      <!-- üé§ Speaker Headline -->
      <h1>üöÄ Power Your Business with Premium Digital Tools</h1>
      <p>Instant Delivery. Secure Checkout. Limited-Time Offers!</p>

      <div class="hero-timer-row">
        <div class="hero-timer-label">‚ö° Mega Sale Ends In:</div>
        <div class="hero-timer" id="mega-sale-timer">Loading...</div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="mega-sale-progress"></div>
      </div>

      <a href="#product-section" id="rotating-cta" class="hero-cta cta-loop">üõçÔ∏è Shop Now</a>
    </section>
  </div>



  <!-- üì¶ Offers Panel -->
  <div id="offersPanel" class="offers-panel">
    <h3 class="offers-title">üî• Amazon Deals</h3>
    <p id="amazonDealText" class="rotating-deal">‚ö° 80% Off on Electronics</p>

    <ul class="offers-list">
      <li><a href="#amazon-banner">Upto 60% Off on Electronics</a></li>
      <li><a href="#amazon-banner">Deals on Software Tools</a></li>
      <li><a href="#amazon-banner">AI Productivity Bundles</a></li>
      <li><a href="#amazon-banner">Top Rated eBooks</a></li>
    </ul>

    <h4 class="offers-subtitle">üì± Stay Updated</h4>
    <input type="tel" placeholder="Enter mobile number" class="offer-input" />
    <button onclick="submitLead()" class="buy-btn">Submit</button>
  </div>


  <!-- üî≥ CATEGORY NAVIGATION -->
  <div class="category-nav-wrapper">

    <!-- üíª Desktop Category Tabs -->
    <div class="category-tabs desktop-only">
      <button class="category-btn active" data-category="all">All</button>
      <button class="category-btn" data-category="office">üßæ Office & Tools</button>
      <button class="category-btn" data-category="design">üßë‚Äçüé® Design & Media</button>
      <button class="category-btn" data-category="marketing">üí¨ Marketing</button>
      <button class="category-btn" data-category="ai">ü§ñ AI & Digital Tools</button>
    </div>

    <!-- ‚ò∞ Mobile Toggle Button -->
    <div class="mobile-category-toggle mobile-only">
      <button id="toggleCategoryMenu" class="category-btn">‚ò∞ Categories</button>
    </div>

    <!-- üì± Mobile Category Menu (Dropdown Style) -->
    <div id="mobileCategoryMenu" class="mobile-category-menu">
      <button class="category-btn" data-category="all">All</button>
      <button class="category-btn" data-category="office">üßæ Office & Tools</button>
      <button class="category-btn" data-category="design">üßë‚Äçüé® Design & Media</button>
      <button class="category-btn" data-category="marketing">üí¨ Marketing</button>
      <button class="category-btn" data-category="ai">ü§ñ AI & Digital Tools</button>
    </div>

  </div>

  <main class="product-grid">
    <div id="productGrid" class="product-grid transition-all duration-300 opacity-100">
      <!-- product cards -->
    </div>
  </main>

  <div id="observer-anchor" style="height: 1px;"></div>

  <div class="counter-wrapper">
    <div id="product-counter" class="product-counter-ui">
      <span class="icon-ring">
        <svg class="receipt-icon" viewBox="0 0 24 24" fill="none">
          <path d="M4 2V22L6 20L8 22L10 20L12 22L14 20L16 22L18 20L20 22V2H4Z" stroke="currentColor"
            stroke-width="1.5" />
          <line x1="8" y1="6" x2="16" y2="6" stroke="currentColor" stroke-width="1.5" />
          <line x1="8" y1="10" x2="16" y2="10" stroke="currentColor" stroke-width="1.5" />
          <line x1="8" y1="14" x2="12" y2="14" stroke="currentColor" stroke-width="1.5" />
        </svg>
      </span>
      Showing <strong class="highlight-number">48</strong> of <strong class="highlight-number">60</strong> products
    </div>
    <div class="custom-progress-bar">
      <div class="progress-bar-fill" id="progressBarFill"></div>
      <span class="progress-label" id="progressLabel">0%</span>
    </div>
  </div>

  <div id="loading-spinner" style="display:none; text-align:center; margin: 20px 0;">
    <div class="spinner"></div>
  </div>

  <div class="text-center mt-4">
    <button id="loadMoreBtn" class="load-more-btn" style="display: none;">Load More</button>
  </div>





  <!-- Product Modal -->
  <div id="product-modal" class="modal">
    <div class="modal-content fade-in">
      <span class="close-button" id="close-modal">&times;</span>
      <h2 id="modal-title"></h2>
      <p id="modal-description"></p>
    </div>
  </div>



  <!-- üîΩ Modern BUYER EMAIL/PHONE MODAL -->
  <!-- Buyer Modal -->
  <div id="buyer-modal" class="buyer-modal-overlay">
    <div class="buyer-modal-content">
      <span class="buyer-close-btn" onclick="closeBuyerModal()">√ó</span>
      <h2 class="buyer-title">üßæ Enter Your Details</h2>

      <label class="buyer-label">üë§ Name
        <input type="text" id="buyer-name" class="buyer-input" required placeholder="Your full name" />
      </label>

      <label class="buyer-label">üìß Email
        <input type="email" id="buyer-email" class="buyer-input" required placeholder="your@email.com" />
      </label>

      <label class="buyer-label">üìû Phone
        <input type="tel" id="buyer-phone" class="buyer-input" required placeholder="98765 43210" />
      </label>

      <div id="status-msg" class="buyer-status"></div>

      <div class="buyer-actions">
        <button onclick="proceedToPay()" class="buyer-btn primary" id="proceed-btn">
          <span class="btn-text">‚úÖ OK</span>
          <span class="buyer-spinner" id="buyer-spinner" style="display: none;"></span>
        </button>
        <button onclick="closeBuyerModal()" class="buyer-btn secondary">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hidden iframe (not used in demo, placeholder) -->
  <iframe name="hidden_iframe" style="display:none;"></iframe>

<script>
  function lockScroll() {
    const scrollY = window.scrollY || window.pageYOffset;
    document.body.classList.add('buyer-scroll-lock');
    document.body.style.top = `-${scrollY}px`;
    document.body.setAttribute('data-scroll-lock', scrollY);
  }

  function unlockScroll() {
    const scrollY = document.body.getAttribute('data-scroll-lock');
    document.body.classList.remove('buyer-scroll-lock');
    document.body.style.top = '';
    document.body.removeAttribute('data-scroll-lock');
    window.scrollTo(0, parseInt(scrollY || '0'));
  }

  function openBuyerModal(productName, productPrice) {
    selectedProductName = productName;
    selectedPrice = productPrice;
    document.getElementById("buyer-modal").classList.add("show");
    document.getElementById("buyer-name").focus();
    lockScroll();
  }

  function closeBuyerModal() {
    document.getElementById("buyer-modal").classList.remove("show");
    unlockScroll();
  }
</script>

  <!-- üöÄ Deals of the Day -->
  <section id="deals-of-the-day" class="dotd-section">
    <h2 class="dotd-heading">üöÄ Deals of the Day</h2>
    <div class="dotd-grid" id="dotd-container">
      <!-- Dynamic cards will load here -->Loading deals of the day...
    </div>
  </section>

  <script src="assets/estore/deals-of-the-day.js" defer></script>




  <!-- üÜï Just Dropped -->
  <section id="just-dropped-section" class="section-block fade-up">
    <h2 class="section-title themed-text">üÜï Just Dropped</h2>
    <div id="just-dropped" class="just-dropped-row">
      <p>Loading fresh drops...</p>
    </div>
  </section>



  <!-- ‚úÖ Combo Offers Section with Modern UI (Glassmorphism) -->
  <!-- üì¶ Combo xOffers -->
  <section id="comboX-offers" class="comboX-wrapper"></section>



  <section id="amazon-banner" class="amazon-banner">
    <div class="amazon-box">
      <h3>üî• Amazon Prime Day Sale</h3>
      <p>Don‚Äôt miss exclusive Prime Day deals (12-14 July)</p>
      <a href="https://amzn.to/4lwo4b0" target="_blank" class="buy-btn">Explore Deals</a>
    </div>
  </section>




  <!-- ‚úÖ Modern Testimonial Swiper (Scoped with .estore_testimonial_) -->
  <section class="estore_testimonial-wrap">
    <div class="estore_testimonial-section">
      <h2 class="estore_testimonial-title">Customer Love üíñ</h2>
      <div class="swiper estore_testimonial-swiper">
        <div class="swiper-wrapper">
          <!-- JS will inject slides here -->
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-pagination"></div>
      </div>
    </div>
  </section>


  <div class="estore_footer-wrapper">
    <footer class="estore_footer-glass">
      <div class="estore_footer-grid">

        <!-- Brand Info + Social + Newsletter -->
        <div class="estore_footer-brand">
          <h2>RanSan Store</h2>
          <p>Your go-to destination for instant downloads, premium tools, and cutting-edge digital solutions. Built for
            creators, startups, and professionals who demand speed and design.</p>

          <div class="estore_footer-socials-subscribe">
            <!-- Social Icons -->
            <div class="estore_footer-icons">
              <a href="#" title="Facebook">üìò</a>
              <a href="#" title="Twitter">üê¶</a>
              <a href="#" title="Instagram">üì∏</a>
              <a href="https://wa.me/918148610567" title="WhatsApp" target="_blank">üí¨</a>
              <a href="mailto:support@ransangroups.com" title="Email" target="_blank">üìß</a>
            </div>

            <!-- Newsletter -->
            <div class="newsletter-wrapper">
              <div class="newsletter-box">
                <input type="email" id="newsletter-email" placeholder="Email address..." />
                <input type="tel" id="newsletter-phone" placeholder="Mobile number..." />
                <button id="subscribe-btn">Subscribe</button>
              </div>
              <div class="newsletter-feedback" id="newsletter-error"></div>
            </div>
          </div>
        </div>

        <!-- Footer Links -->
        <div class="estore_footer-column">
          <h4>Discover</h4>
          <ul>
            <li><a href="#">Explore Templates</a></li>
            <li><a href="#">One-Click Tools</a></li>
            <li><a href="#">AI Bundles</a></li>
            <li><a href="#">Weekly Deals</a></li>
          </ul>
        </div>

        <div class="estore_footer-column">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Live Chat (WhatsApp)</a></li>
            <li><a href="#">Order Tracking</a></li>
            <li><a href="#">Affiliate Program</a></li>
          </ul>
        </div>

        <div class="estore_footer-column">
          <h4>Company</h4>
          <ul>
            <li><a href="about.html">About RanSan</a></li>
            <li><a href="#">Careers (Remote)</a></li>
            <li><a href="#">Creator Partnerships</a></li>
            <li><a href="#">Brand Assets</a></li>
          </ul>
        </div>

        <div class="estore_footer-column">
          <h4>Policies</h4>
          <ul>
            <li><a href="privacy.html" target="_blank">Privacy Policy</a></li>
            <li><a href="terms.html" target="_blank">Terms & Conditions</a></li>
            <li><a href="refund.html" target="_blank">Refund Policy</a></li>
          </ul>
        </div>

      </div>
      <div class="estore_footer-bottom">
        &copy; 2025 RanSan Groups. Built for Speed. Designed for Creators.
      </div>
    </footer>
  </div>

  <script>
    function showProcessingOverlay(mainText, subText) {
      document.getElementById('order-processing-overlay').style.display = 'flex';
      document.getElementById('overlay-main-text').innerText = mainText;
      document.getElementById('overlay-sub-text').innerText = subText;
    }

    function updateOverlayText(mainText, subText) {
      document.getElementById('overlay-main-text').innerText = mainText;
      document.getElementById('overlay-sub-text').innerText = subText;
    }

    function hideProcessingOverlay() {
      document.getElementById('order-processing-overlay').style.display = 'none';
    }
  </script>

  <script>

    //Live
    //const sheetId = '1jdD5SbymV6oNdJZSWZXsSijLcYEwsd_Kc3_Z40YB1lU';
    //const apiKey = 'AIzaSyD910WtP7mqTugPsEv8ZQIMUbyNxOJlDqE';

    //Test
    //const sheetId = '1WnErc845R9CFdhk_WGa5HiOZGE7wjCELmk2fQ4MlKdI';
    //const apiKey = 'AIzaSyBxDzAHIF_EghHtJs6LxYUJL_vaWV9kJNo';

    const productSheetId = getSheetId();
    const productApiKey = getApiKey();

    const range = 'Sheet1!A2:J';
    let allProducts = [];
    let selectedProductName = "";
    let selectedPrice = 0;

    async function fetchProductData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
      const response = await fetch(url);
      const data = await response.json();
      if (data.values && data.values.length > 0) {
        allProducts = data.values;
        displayProducts(allProducts);
        renderAllDealModules(data.values); // ‚úÖ Add this line

      }
    }

    let currentIndex = 0;
    const productsPerPage = 8;
    let allFilteredProducts = [];

    function displayProductsBatch(products) {
      const grid = document.querySelector('.product-grid');
      const loadMoreBtn = document.getElementById("loadMoreBtn");
      const spinner = document.getElementById("loading-spinner");

      // ‚úÖ Show spinner
      if (spinner) spinner.style.display = "block";

      // Simulate delay for smoother load (optional)
      setTimeout(() => {
        const end = currentIndex + productsPerPage;
        const batch = products.slice(currentIndex, end);

        batch.forEach((p, index) => {
          const [name, desc, orig, disc, img, , cat, rating] = p;
          const stockLeft = Math.floor(Math.random() * 5) + 1;

          const card = document.createElement("div");
          card.className = "product-card fade-in";
          card.setAttribute("data-category", cat);
          card.style.animationDelay = `${(currentIndex + index) * 0.05}s`;

          card.innerHTML = `
        <div class="discount-badge">${Math.round(((orig - disc) / orig) * 100)}% OFF</div>
        <a href="${img}" target="_blank">
          <img src="${img}" alt="${name}" class="product-img" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/300x300?text=No+Image';" />
        </a>
        <h2>${name}</h2>
        <div class="price-block">
          <span class="original-price">‚Çπ${orig}</span>
          <span class="discount-price">‚Çπ${disc}</span>
          <span class="discount-percent">(${Math.round(((orig - disc) / orig) * 100)}% OFF)</span>
        </div>
        <p class="stock-info">Only ${stockLeft} licenses left!</p>
        <div class="product-rating">${getStars(rating)} (${rating})</div>
        <div class="trust-note">üõ°Ô∏è 100% Secure Payment</div>
        <div class="hover-actions">
          <a href="#" class="buy-btn" onclick="payWithRazorpay('${name}', ${disc})">Buy Now</a>
          <button class="details-btn" onclick="showProductDetails('${name}', \`${desc}\`, ${disc}, '${img}', ${orig})">üîç</button>
        </div>
      `;

          grid.appendChild(card);
        });

        currentIndex += productsPerPage;

        updateProgressBar(currentIndex, allFilteredProducts.length);

        // ‚úÖ Hide spinner
        if (spinner) spinner.style.display = "none";

        // ‚úÖ Show/hide Load More fallback
        if (currentIndex >= products.length) {
          loadMoreBtn.style.display = "none";
        } else {
          loadMoreBtn.style.display = "inline-block";
        }

        // ‚úÖ Update counter
        updateCounter();


      }, 400); // Delay for better experience
    }



    function displayProducts(products) {
      const grid = document.querySelector('.product-grid');
      grid.innerHTML = "";
      currentIndex = 0;
      allFilteredProducts = products;
      displayProductsBatch(allFilteredProducts);
      initAutoLoadOnScroll(); // ‚úÖ Add this here
      updateCounter();
    }

    document.getElementById("loadMoreBtn").addEventListener("click", () => {
      displayProductsBatch(allFilteredProducts);
    });

    function loadNextBatch() {
      const grid = document.querySelector('.product-grid');
      const loadMoreBtn = document.getElementById("loadMoreBtn");
      const end = currentIndex + batchSize;
      const batch = allFilteredProducts.slice(currentIndex, end);

      batch.forEach((p, index) => {
        const [name, desc, orig, disc, img, , cat, rating] = p;
        const stockLeft = Math.floor(Math.random() * 5) + 1;

        const card = document.createElement("div");
        card.className = "product-card fade-in";
        card.setAttribute("data-category", cat);
        card.style.animationDelay = `${(currentIndex + index) * 0.05}s`;

        card.innerHTML = `
      <div class="discount-badge">${Math.round(((orig - disc) / orig) * 100)}% OFF</div>

      <a href="${img}" target="_blank">
        <img src="${img}" alt="${name}" class="product-img" loading="lazy" />
      </a>

      <h2>${name}</h2>

      <div class="price-block">
        <span class="original-price">‚Çπ${orig}</span>
        <span class="discount-price">‚Çπ${disc}</span>
      </div>

      <p class="stock-info">Only ${stockLeft} licenses left!</p>

      <div class="product-rating">‚≠ê ${rating}</div>

      <div class="trust-note">üõ°Ô∏è 100% Secure Payment</div>

      <div class="hover-actions">
        <a href="#" class="buy-btn" onclick="payWithRazorpay('${name}', ${disc})">Buy Now</a>
        <button class="details-btn" onclick="showProductDetails('${name}', \`${desc}\`, ${disc}, '${img}', ${orig})">üîç</button>
      </div>
    `;

        grid.appendChild(card);
      });

      currentIndex += batchSize;

      if (currentIndex >= allFilteredProducts.length) {
        loadMoreBtn.style.display = "none";
      }

      calculateDiscounts?.();
    }


    async function fetchMegaSaleEndTime() {
      const range = 'Information!A2:B';
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const rows = data.values;

        if (!rows || rows.length === 0) return null;

        for (let row of rows) {
          if (row[0]?.toLowerCase().trim() === 'sale_end_time') {
            return row[1]; // ISO string expected
          }
        }

        return null;
      } catch (err) {
        console.error("‚ùå Failed to load timer.", err);
        return null;
      }
    }

    async function initCountdownFromSheet() {
      const timerDisplay = document.getElementById("countdown");
      const endTimeStr = await fetchMegaSaleEndTime();

      if (!endTimeStr) {
        timerDisplay.textContent = "‚ùå";
        return;
      }

      const saleEndTime = new Date(endTimeStr);

      function updateCountdownFromSheet() {
        const now = new Date();
        const diff = saleEndTime - now;

        if (diff <= 0) {
          timerDisplay.innerHTML = "‚è∞ Expireddd";
          clearInterval(timerInterval);
          return;
        }

        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);

        timerDisplay.innerHTML = `
    <span><strong>${String(d).padStart(2, '0')}</strong><small>d</small></span>
    <span><strong>${String(h).padStart(2, '0')}</strong><small>h</small></span>
    <span><strong>${String(m).padStart(2, '0')}</strong><small>m</small></span>
    <span><strong>${String(s).padStart(2, '0')}</strong><small>s</small></span>
  `;
      }

      updateCountdownFromSheet();
      const timerInterval = setInterval(updateCountdownFromSheet, 1000);
    }

    window.addEventListener("DOMContentLoaded", initCountdownFromSheet);


    function updateCountdown() {
      const targetDate = new Date("July 27, 2025 23:59:59").getTime();
      const timer = setInterval(() => {
        const now = new Date().getTime();
        const diff = targetDate - now;

        if (diff < 0) {
          document.getElementById("countdown").innerHTML = "Expired";



          clearInterval(timer);
          return;
        }

        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById("countdown").innerHTML = `
      <span>${d}d</span><span>${h}h</span><span>${m}m</span><span>${s}s</span>
    `;
      }, 1000);
    }
    window.addEventListener('load', updateCountdown);

    function calculateDiscounts() {
      document.querySelectorAll('.price-block').forEach(b => {
        const orig = parseFloat(b.dataset.original);
        const disc = parseFloat(b.dataset.discount);
        if (orig > disc) {
          const pct = Math.round(((orig - disc) / orig) * 100);
          b.querySelector('.discount-percent').textContent = `(${pct}% OFF)`;
        }
      });
    }

    function showDetails(title, desc) {
      document.getElementById('modal-title').textContent = title;
      document.getElementById('modal-description').innerHTML = desc.replace(/\n/g, "<br>");
      document.getElementById('product-modal').style.display = 'flex';

      // ‚úÖ Show sticky buy bar on mobile
      const buyBar = document.getElementById('mobile-buy-bar');
      buyBar.classList.remove('hidden');

      // Handle Buy button click
      document.getElementById('mobile-buy-btn').onclick = function () {
        payWithRazorpay(title, selectedPrice); // Use your existing function
      };
    }

    document.getElementById('close-modal').onclick = () => {
      document.getElementById('product-modal').style.display = 'none';

      // ‚úÖ Hide sticky buy bar when modal closes
      document.getElementById('mobile-buy-bar').classList.add('hidden');
    };

    window.onclick = function (e) {
      if (e.target.id === "buyer-modal") {
        document.getElementById('buyer-modal').classList.remove('show');
      }
      if (e.target.id === "product-modal") {
        document.getElementById('product-modal').style.display = 'none';
      }
    }

    // üîΩ MODAL EMAIL/CHECKOUT HANDLING
    function payWithRazorpay(productName, price) {
      selectedProductName = productName;
      selectedPrice = price;
      document.getElementById('buyer-modal').classList.add('show');
    }
    function closeBuyerModal() {
      document.getElementById('buyer-modal').classList.remove('show');
    }



    async function proceedToPay() {
      const name = document.getElementById("buyer-name").value.trim();
      const email = document.getElementById("buyer-email").value.trim();
      const phone = document.getElementById("buyer-phone").value.trim();
      const status = document.getElementById("status-msg");
      const spinner = document.getElementById("buyer-spinner");

      if (!name || !email || !phone) {
        status.innerText = "‚ö†Ô∏è Please fill all fields.";
        return;
      }

      status.innerText = "‚è≥ Capturing your details...";
      spinner.style.display = "inline-block"; // ‚úÖ Show the spinner

      const uniqueTimestamp = getISTTimestampISO();

      const leadData = {
        name,
        email,
        phone,
        product: selectedProductName,
        amount: selectedPrice,
        intent: "Interested - Not Paid Yet",
        payment_id: "",
        timestamp: uniqueTimestamp
      };

      try {
        await fetch(getScriptURL("estore_payment"), {
          method: "POST",
          body: JSON.stringify(leadData)
        });
      } catch (e) {
        console.warn("‚ö†Ô∏è Lead save failed, continuing to payment.");
      }

      document.getElementById('buyer-modal').classList.remove('show');

      // ‚úÖ Show overlay with scroll lock
      showInvoiceProcessingOverlay("‚è≥ Processing Payment", "Please wait, do not refresh the page...");
      startInvoiceProcessingProgress();

      const options = {
        key: getRazorpayKey(),
        //key: "rzp_test_iOdWWEhKlikqRy",
        amount: selectedPrice * 100,
        currency: "INR",
        name: "RanSan Groups",
        description: selectedProductName,

        handler: async function (response) {
          showInvoiceProcessingOverlay("‚úÖ Payment Successful", "‚è≥ Generating Invoice & Delivery...");

          // üëá This starts the animated progress bar and percentage
          updateInvoiceSteps();
          startInvoiceProcessingProgress();


          const paidData = {
            ...leadData,
            intent: "Paid Order",
            payment_id: response.razorpay_payment_id
          };

          try {
            await fetch(getScriptURL("estore_payment"), {
              method: "POST",
              body: JSON.stringify(paidData)
            });

            const postData = new URLSearchParams({
              name: paidData.name,
              email: paidData.email,
              phone: paidData.phone,
              product: paidData.product,
              amount: paidData.amount,
              payment_id: paidData.payment_id
            });

            const res = await fetch(getScriptURL("invoice_generation"), {
              method: "POST",
              body: postData
            });

            const text = await res.text();

            if (text.includes("Success")) {

              showInvoiceProcessingOverlay("‚úÖ Order Completed!", "üéÅ Delivery sent to Email & WhatsApp. Redirecting...");
              completeInvoiceProcessingProgress();
              launchConfetti(); // üéä Launch party!
              setTimeout(() => {
                hideInvoiceProcessingOverlay();
                window.location.href = "https://www.ransangroups.com/thank-you.html";
              }, 3000);
            } else {
              showInvoiceProcessingOverlay("‚ö†Ô∏è Invoice Failed", "Payment succeeded but delivery failed. Please contact support.");
            }
          } catch (err) {
            console.error("‚ùå Post-payment error:", err);
            showInvoiceProcessingOverlay("‚ùå Delivery Failed", "Payment captured, but delivery failed. Contact support.");
          } finally {
            spinner.style.display = "none"; // ‚úÖ Hide spinner
          }
        },

        modal: {
          ondismiss: function () {
            showInvoiceProcessingOverlay("‚ùå Payment Cancelled", "You have closed the payment. No amount was deducted.");
            spinner.style.display = "none";
            setTimeout(() => {
              hideInvoiceProcessingOverlay();
              window.location.reload();
            }, 3000);
          }
        },

        prefill: { name, email, contact: phone },
        theme: { color: "#9A22F6" }
      };

      try {
        const rzp = new Razorpay(options);
        rzp.open();
      } catch (err) {
        alert("‚ö†Ô∏è Razorpay failed to load. Please check your key.");
        hideInvoiceProcessingOverlay();
        spinner.style.display = "none";
      }
    }

    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const cat = btn.getAttribute('data-category');
        const filtered = cat === "all" ? allProducts : allProducts.filter(p => p[6] === cat);
        displayProducts(filtered);
      });
    });

    //window.onload = fetchProductData;

    document.getElementById("loadMoreBtn").addEventListener("click", loadNextBatch);

    window.addEventListener('load', function () {

      updateCountdown();
      fetchProductData();

      setTimeout(() => {
        document.getElementById('lead-modal').style.display = 'flex';
      }, 3000);
    });

    function getStars(r) {
      const f = '‚òÖ'.repeat(Math.floor(r));
      const h = (r % 1 >= 0.5) ? '¬Ω' : '';
      const e = '‚òÜ'.repeat(5 - Math.ceil(r));
      return f + h + e;
    }
  </script>

  <script>
    window.addEventListener("error", function (e) {
      if (e?.error?.message?.includes("Razorpay")) {
        alert("‚ö†Ô∏è Razorpay Error: Check your internet or API key.");
      } else {
        console.warn("JS Error ignored:", e.message);
      }
    });
  </script>




  <script>
    function showDetailsModal(title, desc) {
      document.getElementById('modal-title').innerText = title;
      document.getElementById('modal-description').innerText = desc;
      document.getElementById('details-modal').style.display = 'flex';
    }

    function closeDetailsModal() {
      document.getElementById('details-modal').style.display = 'none';
    }
  </script>

  <script>
    function showProductDetails(name, desc, discountPrice, imageUrl, originalPrice) {
      const discountPercent = Math.round(((originalPrice - discountPrice) / originalPrice) * 100);

      // üñºÔ∏è Convert Google Drive link (if needed)
      if (imageUrl.includes("drive.google.com") && !imageUrl.includes("uc?export=view")) {
        const fileIdMatch = imageUrl.match(/\/d\/([^\/]+)/);
        if (fileIdMatch) {
          const fileId = fileIdMatch[1];
          imageUrl = `https://drive.google.com/uc?export=view&id=${fileId}`;
        }
      }

      const imgElem = document.getElementById('modal-product-img');

      // üßπ Reset image first to avoid "flash"
      imgElem.src = "";
      imgElem.style.opacity = "0";

      // Load image fully before showing
      const tempImg = new Image();
      tempImg.onload = () => {
        imgElem.src = imageUrl;
        imgElem.style.opacity = "1";
      };
      tempImg.onerror = () => {
        imgElem.src = "https://via.placeholder.com/300x300?text=Image+Not+Available";
        imgElem.style.opacity = "1";
      };
      tempImg.src = imageUrl;

      document.getElementById('modal-product-name').innerText = name;
      document.getElementById('modal-product-desc').innerText = desc;

      document.getElementById('modal-product-pricing').innerHTML = `
      <span class="original-price">‚Çπ${originalPrice}</span>
      <span class="discount-price">‚Çπ${discountPrice}</span>
      <span class="discount-percent">(${discountPercent}% OFF)</span>
    `;

      document.getElementById('modal-buy-btn').onclick = () => {
        payWithRazorpay(name, discountPrice);
        closeProductModal();
      };

      document.getElementById('product-details-modal').style.display = 'flex';
      document.body.classList.add('no-scroll');
    }

    function closeProductModal() {
      document.getElementById('product-details-modal').style.display = 'none';
      document.body.classList.remove('no-scroll'); // ‚úÖ change this line
    }
  </script>


  <script>
    // Define CTA options (Text + Target Section)
    const ctaOptions = [
      { text: "Deals of the Day", target: "deals-of-the-day" },
      { text: "Just Dropped", target: "just-dropped-section" },
      { text: "Combo Offers", target: "comboX-offers" },
      { text: "Amazon Sale", target: "amazon-banner" }
    ];

    let ctaIndex = 0;
    const ctaButton = document.getElementById('rotating-cta');

    // Function to update CTA text
    function updateCTA() {
      ctaButton.innerText = ctaOptions[ctaIndex].text;
    }

    // Rotate text every 4 seconds
    setInterval(() => {
      ctaIndex = (ctaIndex + 1) % ctaOptions.length;
      updateCTA();
    }, 4000);

    // Initial load
    updateCTA();

    // Handle click event
    ctaButton.addEventListener('click', () => {
      const targetId = ctaOptions[ctaIndex].target;
      const element = document.getElementById(targetId);
      if (element) {
        // If it's a modal, open it
        if (element.classList.contains('modal')) {
          element.style.display = 'flex';
        } else {
          // Scroll to section
          element.scrollIntoView({ behavior: "smooth" });
        }
      }
    });
  </script>

  <script>
    // Show the mobile buy bar only on mobile after page load
    window.addEventListener('load', function () {
      const mobileBtn = document.getElementById('mobile-buy-btn');
      const hotDeals = document.getElementById('hot-deals-slider');

      if (window.innerWidth <= 767 && mobileBtn) {
        document.getElementById('mobile-buy-bar').classList.remove('hidden');

        mobileBtn.addEventListener('click', function () {
          if (hotDeals) {
            hotDeals.scrollIntoView({ behavior: 'smooth' });
          }
        });
      }
    });
  </script>

  <script>
    function animateDealsOfDayCards() {
      const cards = document.querySelectorAll('.dotd-card');
      cards.forEach((card, i) => {
        setTimeout(() => {
          card.classList.add('animate-in');
        }, i * 200); // Staggered animation: 0.2s between cards
      });
    }
  </script>

  <script>
    async function loadJustDropped() {
      const container = document.getElementById("just-dropped");
      container.innerHTML = `<p>Loading fresh drops...</p>`;

      const productSheetId = getSheetId();
      const productApiKey = getApiKey();

      const range = 'Sheet1!A1:Z1000';

      function convertDriveLink(url) {
        const idMatch = url.match(/[-\w]{25,}/);
        return idMatch ? `https://lh3.googleusercontent.com/d/${idMatch[0]}=s600` : "";
      }

      try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
        const data = await response.json();
        const rows = data.values;

        if (!rows || rows.length < 2) {
          container.innerHTML = `<p>No fresh drops found.</p>`;
          return;
        }

        const headers = rows[0];
        const bodyRows = rows.slice(1);
        const last3 = bodyRows.slice(-3).reverse();

        const cards = last3.map((row, index) => {
          const name = row[0] || "Unnamed";                 // A
          const desc = row[1] || "No description";          // B
          const orig = parseFloat(row[2]) || 0;             // C
          const disc = parseFloat(row[3]) || 0;             // D
          const rawImg = row[4] || "";                      // E
          const img = convertDriveLink(rawImg);

          const discountPercent = (orig && disc) ? Math.round(((orig - disc) / orig) * 100) : 0;

          return `
          <div class="just-dropped-card">
            <div class="drop-img-wrapper">
              <img src="${img}" alt="${name}" class="drop-img" loading="lazy"
                onerror="this.src='https://via.placeholder.com/300x300?text=No+Image';">
              <span class="new-badge">NEW</span>
            </div>
            <div class="product-title">${name}</div>
            <div class="product-price">‚Çπ${disc} <del>‚Çπ${orig}</del> <span class="discount">(${discountPercent}% OFF)</span></div>
            <button class="drop-view-btn"
              onclick="showProductDetails(
                '${name.replace(/'/g, "\\'")}',
                \`${desc.replace(/`/g, "\\`")}\`,
                ${parseFloat(disc) || 0},
                '${img}',
                ${parseFloat(orig) || 0}
              )">
              üëÅÔ∏è View
            </button>
          </div>
        `;
        }).join("");

        container.innerHTML = cards || `<p>No fresh drops available.</p>`;

      } catch (err) {
        console.error("Just Dropped Error:", err);
        container.innerHTML = `<p>Error loading fresh drops.</p>`;
      }
    }

    loadJustDropped();
  </script>

  <script>
    async function loadComboOffers() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${dealSheetId}/values/${dealRange}?key=${dealApiKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const rows = data.values;
        const container = document.getElementById("combo-offers");
        if (!container || !rows) return;

        const descCol = 18; // Column S (zero-based index)
        const priceCol = 19; // Column T
        const benefit1 = 20; // Col U
        const benefit2 = 21; // Col V
        const benefit3 = 22; // Col W

        const validRows = rows.filter(r => r[descCol] && r[priceCol]);

        if (!validRows.length) {
          container.innerHTML = `<p>No combo offers available.</p>`;
          return;
        }

        const offerCards = validRows.map(r => `
        <div class="combo-offer-card">
          <div class="combo-desc">${r[descCol]}</div>


<a class="view-benefits" onclick="toggleBenefits(this)">+ View Benefits</a>
<ul class="combo-benefits hidden">
  <li><span class="emoji tool">üîì</span> Unlock 3 Premium Tools</li>
  <li><span class="emoji support">üí¨</span> 24x7 WhatsApp Support</li>
  <li><span class="emoji invoice">üìÑ</span> Instant PDF Invoice</li>
</ul>

          <div class="combo-price">üí∞ ${r[priceCol]}</div>
          <a class="combo-buy-btn" onclick="showProductDetails('${r[descCol]}')">üí≥ Avail Now</a>
          
        </div>
      `).join("");

        container.innerHTML = `
        <h2 style="margin-bottom:10px;">üì¶ Combo Offers</h2>
        <div class="combo-offer-list">${offerCards}</div>
      `;
      } catch (err) {
        console.error("Combo Offers Error:", err);
        document.getElementById("combo-offers-container").innerHTML = `<p>Error loading combo offers.</p>`;
      }



    }

    // Auto-call the function
    loadComboOffers();
  </script>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      loadJustDropped();
      loadComboOffers();
      loadComboXOffers();
    });
  </script>

  <script>
    function toggleBenefits(el) {
      const list = el.nextElementSibling;
      list.classList.toggle('hidden');
      el.textContent = list.classList.contains('hidden') ? '+ View Benefits' : '‚àí Hide Benefits';
    }
  </script>

  <script>
    window.addEventListener('scroll', function () {
      const header = document.getElementById('main-header');
      if (window.scrollY > 20) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const hamburger = document.getElementById('hamburgerBtn');
      const menu = document.getElementById('mobileMenu');

      if (hamburger && menu) {
        hamburger.addEventListener('click', () => {
          menu.classList.toggle('open');
        });
      }
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleBtn = document.getElementById("searchToggle");
      const searchBox = document.getElementById("searchBox");
      const searchInput = document.getElementById("searchInput");

      // Show/hide search input on icon click
      toggleBtn.addEventListener("click", () => {
        if (searchBox.style.display === "none") {
          searchBox.style.display = "block";
          searchInput.focus();
        } else {
          searchBox.style.display = "none";
        }
      });

      // Filter products as you type
      searchInput.addEventListener("input", function () {
        const keyword = this.value.toLowerCase();
        const filtered = allProducts.filter(p =>
          p[0]?.toLowerCase().includes(keyword) ||
          p[1]?.toLowerCase().includes(keyword)
        );
        displayProducts(filtered);
      });
    });
  </script>

  <script>
    function getStars(rating) {
      const fullStars = Math.floor(rating);
      const stars = "‚≠ê".repeat(fullStars);
      const empty = "‚òÜ".repeat(5 - fullStars);
      return stars + empty;
    }
  </script>

  <!--offer widge-->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleBtn = document.getElementById("offersToggleBtn");
      const offerPanel = document.getElementById("offersPanel");

      // ‚úÖ Toggle panel on click
      toggleBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        offerPanel.classList.toggle("show");
      });

      // ‚úÖ Close panel on outside click
      document.addEventListener("click", (e) => {
        if (!offerPanel.contains(e.target) && !toggleBtn.contains(e.target)) {
          offerPanel.classList.remove("show");
        }
      });

      // ‚úÖ ESC key to close
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          offerPanel.classList.remove("show");
        }
      });

      // ‚úÖ Deal rotator (if #amazonDealText exists)
      const amazonDeals = [
        "‚ö° 80% Off on Electronics",
        "üéß Noise Cancelling Headphones ‚Çπ1,999",
        "üì± Best Phones Under ‚Çπ10K",
        "üíª Top Laptops Deals",
        "üì¶ Combo: Amazon + Flipkart + Meesho"
      ];
      const dealTextEl = document.getElementById("amazonDealText");
      if (dealTextEl) {
        setInterval(() => {
          const random = Math.floor(Math.random() * amazonDeals.length);
          dealTextEl.textContent = `üî• ${amazonDeals[random]}`;
        }, 5000);
      }

      // ‚úÖ Handle submit button
      const submitBtn = offerPanel.querySelector("button.buy-btn");
      submitBtn.addEventListener("click", () => {
        const input = offerPanel.querySelector("input.offer-input");
        const number = input.value.trim();
        if (number.length >= 10) {
          submitLead(number); // ‚úÖ Calls your existing function

          // ‚úÖ Clear old message if exists
          const existingMsg = offerPanel.querySelector(".offer-success-msg");
          if (existingMsg) existingMsg.remove();

          // ‚úÖ Show success message above the button
          const successMsg = document.createElement("div");
          successMsg.textContent = "‚úÖ Thank you! You'll be notified soon.";
          successMsg.className = "offer-success-msg";
          offerPanel.insertBefore(successMsg, submitBtn);

          // ‚úÖ Clear input
          input.value = "";

          // ‚úÖ Auto-hide after 3s
          setTimeout(() => {
            offerPanel.classList.remove("show");
            successMsg.remove();
          }, 3000);
        } else {
          alert("Please enter a valid mobile number.");
        }
      });
    });
  </script>

  <!--offer widge-->

  <!--Scroll-->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const backToTopBtn = document.getElementById("backToTop");

      window.addEventListener("scroll", () => {
        const scrollY = window.scrollY;
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const scrollPercent = scrollY / docHeight;

        // Show if scrolled more than 30%
        if (scrollPercent > 0.3) {
          backToTopBtn.classList.add("show");
        } else {
          backToTopBtn.classList.remove("show");
        }
      });

      backToTopBtn.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    });
  </script>
  <!--Scroll-->

  <!--Scrolling progress-->
  <script>
    window.addEventListener("scroll", () => {
      const scrollTop = window.scrollY;
      const docHeight = document.body.scrollHeight - window.innerHeight;
      const scrolled = (scrollTop / docHeight) * 100;
      document.getElementById("scrollProgress").style.width = `${scrolled}%`;
    });
  </script>

  <!--Scrolling progress-->

  <!--Dark Mode-->
  <script>
    document.getElementById("darkModeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
    });
  </script>
  <!--Dark Mode-->

  <!--Mobile catagory start-->
  <script>
    const toggleBtn = document.getElementById("toggleCategoryMenu");
    const mobileMenu = document.getElementById("mobileCategoryMenu");
    const allCatBtns = document.querySelectorAll(".category-btn[data-category]");

    // üß† Helper to highlight active category
    function setActiveCategory(category) {
      allCatBtns.forEach(btn => btn.classList.remove("active"));
      document.querySelector(`.category-btn[data-category="${category}"]`)?.classList.add("active");
    }

    // üîÅ Toggle menu ‚Üí always show all products
    toggleBtn?.addEventListener("click", () => {
      const isOpen = mobileMenu.style.display === "flex";
      mobileMenu.style.display = isOpen ? "none" : "flex";

      // ‚úÖ Always show all products on toggle
      if (typeof filterProducts === "function") {
        filterProducts('all');
        setActiveCategory('all');
      }
    });

    // üñ±Ô∏è On category click ‚Üí filter products
    allCatBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const selected = btn.getAttribute("data-category");
        setActiveCategory(selected);

        if (typeof filterProducts === "function") {
          filterProducts(selected);
        }

        // üîí Hide menu on mobile after click
        if (window.innerWidth <= 768) {
          mobileMenu.style.display = "none";
        }
      });
    });

    // üöÄ Show all products on page load
    window.addEventListener("DOMContentLoaded", () => {
      if (typeof filterProducts === "function") {
        filterProducts('all');
        setActiveCategory('all');
      }
    });
  </script>
  <!--Mobile catagory end-->

  <!--Timestamp convert start-->
  <script>
    function formatToISTDate(timestamp) {
      try {
        const date = new Date(timestamp);
        // Convert UTC to IST (UTC + 5:30)
        const istOffset = 330; // in minutes
        const istTime = new Date(date.getTime() + istOffset * 60000);

        const options = {
          year: 'numeric', month: 'short', day: 'numeric',
          hour: '2-digit', minute: '2-digit', second: '2-digit',
          hour12: true,
          timeZone: 'Asia/Kolkata'
        };

        return istTime.toLocaleString('en-IN', options);
      } catch (e) {
        console.warn("Invalid timestamp:", timestamp);
        return timestamp;
      }
    }

  </script>
  <!--Timestamp convert end-->

  <!--Load more start -->
  <script>
    function showLoadingSpinner() {
      document.getElementById("loading-spinner").style.display = "block";
    }
    function hideLoadingSpinner() {
      document.getElementById("loading-spinner").style.display = "none";
    }
    function updateCounter() {
      const counterEl = document.getElementById('product-counter');
      const total = allFilteredProducts.length;
      const current = Math.min(currentIndex, total);

      if (total === 0) {
        counterEl.innerHTML = `
      <span class="icon-ring">
        <svg class="receipt-icon" viewBox="0 0 24 24" fill="none">
          <path d="M4 2V22L6 20L8 22L10 20L12 22L14 20L16 22L18 20L20 22V2H4Z" stroke="currentColor" stroke-width="1.5" />
          <line x1="8" y1="6" x2="16" y2="6" stroke="currentColor" stroke-width="1.5" />
          <line x1="8" y1="10" x2="16" y2="10" stroke="currentColor" stroke-width="1.5" />
          <line x1="8" y1="14" x2="12" y2="14" stroke="currentColor" stroke-width="1.5" />
        </svg>
      </span>
      <strong>No products found</strong>`;
        return;
      }

      // First: render both numbers as 0
      counterEl.innerHTML = `
    <span class="icon-ring">
      <svg class="receipt-icon" viewBox="0 0 24 24" fill="none">
        <path d="M4 2V22L6 20L8 22L10 20L12 22L14 20L16 22L18 20L20 22V2H4Z" stroke="currentColor" stroke-width="1.5" />
        <line x1="8" y1="6" x2="16" y2="6" stroke="currentColor" stroke-width="1.5" />
        <line x1="8" y1="10" x2="16" y2="10" stroke="currentColor" stroke-width="1.5" />
        <line x1="8" y1="14" x2="12" y2="14" stroke="currentColor" stroke-width="1.5" />
      </svg>
    </span>
    Showing <strong class="highlight-number" id="countNow">0</strong>
    of <strong class="highlight-number" id="countTotal">0</strong> products
  `;

      // Second: wait a few ms before triggering animation
      setTimeout(() => {
        animateNumber(document.getElementById("countNow"), current);
        animateNumber(document.getElementById("countTotal"), total);
      }, 50); // Ensures DOM flushes and 0 is visible first
    }

    function initAutoLoadOnScroll() {
      const anchor = document.getElementById('observer-anchor');
      if (!anchor) return;
      const observer = new IntersectionObserver(entries => {
        if (entries[0].isIntersecting) {
          showLoadingSpinner();
          setTimeout(() => {
            displayProductsBatch(allFilteredProducts);
            updateCounter();
            hideLoadingSpinner();
          }, 500);
        }
      }, { rootMargin: '200px' });
      observer.observe(anchor);
    }
  </script>
  <!--Load more end -->


  <!--Progress bar start-->
  <script>
    function updateProgressBar(current, total) {
      const clampedCurrent = Math.min(current, total); // ‚úÖ prevent overfill
      const percent = Math.round((clampedCurrent / total) * 100);

      const fill = document.getElementById('progressBarFill');
      const label = document.getElementById('progressLabel');

      fill.style.width = percent + '%';
      label.textContent = percent + '%';
    }
  </script>
  <!--Progress bar end-->

  <!--animate number start-->
  <script>
    const tick = document.getElementById("tickSound");

    function animateNumber(el, target) {
      let current = 0;
      const step = Math.ceil(target / 30);
      const interval = setInterval(() => {
        current += step;
        if (current >= target) {
          el.textContent = target;
          clearInterval(interval);
        } else {
          el.textContent = current;
          tick?.play(); // ‚úÖ play sound
        }
      }, 40);
    }
  </script>
  <!--animate number end-->


  <script>
    function filterByCategory(category) {
      const grid = document.getElementById('productGrid');
      grid.classList.add('opacity-0');

      setTimeout(() => {
        // Update products here (clear + render new set)
        renderProducts(category);
        grid.classList.remove('opacity-0');
      }, 200);
    }
  </script>

  <script>
    let processingPercent = 0;
    let progressInterval = null;

    function showProcessingOverlay(mainText, subText) {
      document.getElementById("overlay-main-text").innerText = mainText;
      document.getElementById("overlay-sub-text").innerText = subText;
      document.getElementById("order-processing-overlay").style.display = "flex";
    }

    function hideProcessingOverlay() {
      document.getElementById("order-processing-overlay").style.display = "none";
    }

    function startProcessingProgress() {
      clearInterval(progressInterval);
      processingPercent = 0;

      const percentEl = document.getElementById("processing-percentage");
      percentEl.textContent = "0%";
      percentEl.classList.remove("fade-out");

      // ‚è≥ Wait until DOM visually renders the overlay before counting
      requestAnimationFrame(() => {
        setTimeout(() => {
          progressInterval = setInterval(() => {
            if (processingPercent < 98) {
              processingPercent += 1;
              percentEl.textContent = processingPercent + "%";
            } else {
              clearInterval(progressInterval); // ‚è∏Ô∏è pause at 98%
            }
          }, 100);
        }, 200); // ‚úÖ Give DOM ~200ms to paint the spinner and % text
      });
    }

    function completeProcessingProgress() {
      clearInterval(progressInterval);
      const percentEl = document.getElementById("processing-percentage");

      // Animate to 100%
      let temp = processingPercent;
      const finalInterval = setInterval(() => {
        if (temp < 100) {
          temp += 1;
          percentEl.textContent = temp + "%";
        } else {
          clearInterval(finalInterval);
          percentEl.classList.add("fade-out");
          setTimeout(() => {
            percentEl.innerHTML = "‚úÖ";
            percentEl.classList.remove("fade-out");
            percentEl.classList.add("fade-in");
          }, 500);
        }
      }, 30);
    }
  </script>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!-- Google Sheet Testimonial Loader (Cleaned & Final) -->
  <script>
    function loadTestimonialsFromGoogleSheet() {
      const sheetID = getTestimonialSheetId();
      console.log("üé§ Testimonial Sheet ID:", sheetID)
      const sheetName = "Testimonial";
      const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

      fetch(url)
        .then((res) => res.text())
        .then((text) => {
          const json = JSON.parse(text.substring(47).slice(0, -2));
          const rows = json.table.rows;

          const wrapper = document.querySelector(".estore_testimonial-swiper .swiper-wrapper");
          wrapper.innerHTML = "";

          // ‚úÖ Skip the first row (header) and filter valid rows only
          rows.slice(1).forEach((row) => {
            const name = row.c[0]?.v?.trim();
            const quote = row.c[1]?.v?.trim();
            const avatar = row.c[2]?.v?.trim();

            if (!name || !quote || !avatar) return; // ‚úÖ Skip empty rows

            const slide = document.createElement("div");
            slide.className = "swiper-slide";
            slide.innerHTML = `
            <div class="estore_testimonial-card">
              <p class="estore_testimonial-quote">‚Äú${quote}‚Äù</p>
              <div class="estore_testimonial-user">
                <img src="${avatar}" class="estore_testimonial-avatar" alt="${name}">
                <div class="estore_testimonial-name">${name}</div>
              </div>
            </div>
          `;
            wrapper.appendChild(slide);
          });

          // ‚úÖ Initialize Swiper AFTER content is populated
          new Swiper(".estore_testimonial-swiper", {
            loop: true,
            autoplay: {
              delay: 4000,
              disableOnInteraction: false
            },
            slidesPerView: 2,
            spaceBetween: 30,
            breakpoints: {
              0: { slidesPerView: 1 },
              768: { slidesPerView: 2 }
            },
            navigation: {
              nextEl: ".swiper-button-next",
              prevEl: ".swiper-button-prev"
            },
            pagination: {
              el: ".swiper-pagination",
              clickable: true
            }
          });
        })
        .catch((err) => {
          console.error("Failed to fetch testimonials:", err);
        });
    }

    window.addEventListener("DOMContentLoaded", loadTestimonialsFromGoogleSheet);
  </script>

  <!-- Footer validation with submit) -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.getElementById("newsletter-email");
      const phoneInput = document.getElementById("newsletter-phone");
      const feedback = document.getElementById("newsletter-error");
      const subscribeBtn = document.getElementById("subscribe-btn");

      const originalBtnHTML = subscribeBtn.innerHTML;

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function validatePhone(phone) {
        return /^[6-9]\d{9}$/.test(phone);
      }

      function showSpinner() {
        subscribeBtn.innerHTML = `<span class="spinner"></span>`;
        subscribeBtn.disabled = true;
      }

      function resetButton() {
        subscribeBtn.innerHTML = originalBtnHTML;
        subscribeBtn.disabled = false;
      }

      async function sendWhatsAppMessage(phone, message) {

        const proxyUrl = getFollowupProxyURL();

        const payload = {
          phone: phone.startsWith("91") ? phone : "91" + phone,
          message: message
        };

        try {
          await fetch(proxyUrl, {
            method: "POST",
            body: JSON.stringify(payload)
          });
        } catch (e) {
          console.error("WhatsApp message failed:", e);
        }
      }

      async function submitNewsletter() {
        const email = emailInput.value.trim();
        const phone = phoneInput.value.trim();

        feedback.style.color = "#f96fdc";
        feedback.textContent = "";

        const isEmailValid = validateEmail(email);
        const isPhoneValid = validatePhone(phone);

        if (!isEmailValid && !isPhoneValid) {
          feedback.textContent = "‚ö†Ô∏è Please enter a valid email and 10-digit mobile number.";
          return;
        } else if (!isEmailValid) {
          feedback.textContent = "‚ö†Ô∏è Please enter a valid email address.";
          return;
        } else if (!isPhoneValid) {
          feedback.textContent = "‚ö†Ô∏è Please enter a valid 10-digit mobile number.";
          return;
        }

        showSpinner();
        feedback.textContent = "";

        try {

          const sheetURL = getNewsletterSubmitURL();

          const res = await fetch(sheetURL, {
            method: "POST",
            body: JSON.stringify({ email, phone })
          });

          const result = await res.json();

          if (result.status === "success") {
            feedback.style.color = "#7cf6a5";
            feedback.textContent = "‚úÖ Subscribed successfully!";
            emailInput.value = "";
            phoneInput.value = "";
            subscribeBtn.innerHTML = "‚úÖ Subscribed";

            // WhatsApp message (optional)
            await sendWhatsAppMessage(phone, `üéâ Thank you for subscribing to RanSan Groups Deals! We‚Äôll send you exclusive discounts soon.`);

            // Optional: soft refresh after delay
            setTimeout(() => {
              resetButton();
              location.reload(); // remove this if you want no reload
            }, 2000);
          } else {
            throw new Error(result.message || "Unknown error");
          }
        } catch (err) {
          feedback.style.color = "#f96fdc";
          feedback.textContent = "‚ùå Submission failed. Try again later.";
          resetButton();
        }
      }

      subscribeBtn.addEventListener("click", function (e) {
        e.preventDefault();
        submitNewsletter();
      });
    });
  </script>


  <script>


    async function fetchSaleTimes() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Information!A2:B?key=${apiKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const rows = data.values;

        let start = null, end = null;

        for (let row of rows) {
          const key = row[0]?.toLowerCase().trim();
          const val = row[1];
          if (key === "sale_start_time") start = new Date(val);
          if (key === "sale_end_time") end = new Date(val);
        }

        return { start, end };
      } catch (err) {
        console.error("‚ùå Error fetching timer data", err);
        return null;
      }
    }

    function getColorClass(diff) {
      if (diff <= 6 * 3600000) return "time-red";
      if (diff <= 24 * 3600000) return "time-orange";
      return "time-green";
    }

    function renderTimer(diff) {
      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const s = Math.floor((diff % (1000 * 60)) / 1000);
      const cls = getColorClass(diff);

      return `
      <div class="time-block ${cls}">
        <div class="time-num">${String(d).padStart(2, '0')}</div>
        <div class="time-label">D</div>
      </div>
      <div class="time-block ${cls}">
        <div class="time-num">${String(h).padStart(2, '0')}</div>
        <div class="time-label">H</div>
      </div>
      <div class="time-block ${cls}">
        <div class="time-num">${String(m).padStart(2, '0')}</div>
        <div class="time-label">M</div>
      </div>
      <div class="time-block ${cls}">
        <div class="time-num">${String(s).padStart(2, '0')}</div>
        <div class="time-label">S</div>
      </div>
    `;
    }

    async function initMegaSaleCountdown() {
      const { start, end } = await fetchSaleTimes();
      if (!start || !end) return;

      const timerEl = document.getElementById("mega-sale-timer");
      const progressBar = document.getElementById("mega-sale-progress");
      const cta = document.getElementById("rotating-cta");

      function update() {
        const now = new Date();
        const total = end - start;
        const remaining = end - now;
        const elapsed = now - start;

        if (remaining <= 0) {
          timerEl.innerHTML = "<strong>‚è∞ Offer Ended!</strong>";
          if (cta) cta.style.display = "none";
          progressBar.style.width = "100%";
          progressBar.style.background = "#e74c3c";
          clearInterval(intervalId);
          return;
        }

        timerEl.innerHTML = renderTimer(remaining);

        const percent = Math.min(100, Math.max(0, (elapsed / total) * 100));
        progressBar.style.width = percent.toFixed(2) + "%";

        // Color sync
        if (remaining <= 6 * 3600000) progressBar.style.background = "#e74c3c";
        else if (remaining <= 24 * 3600000) progressBar.style.background = "#f39c12";
        else progressBar.style.background = "#2ecc71";
      }

      update();
      const intervalId = setInterval(update, 1000);
    }

    window.addEventListener("DOMContentLoaded", initMegaSaleCountdown);
  </script>

<script>
  let invoiceProgressInterval;
  let invoiceProgress = 0;

  function showInvoiceProcessingOverlay(title = "Processing...", message = "") {
    document.getElementById("invoice-overlay-title").innerText = title;
    document.getElementById("invoice-overlay-message").innerText = message;
    document.getElementById("invoice-overlay").classList.add("show");
    document.body.style.overflow = "hidden";
    window.scrollTo({ top: 0, behavior: "smooth" });

    invoiceProgress = 0;
    document.getElementById("invoiceProgressBar").style.width = "0%";
    document.getElementById("invoiceProgressText").innerText = "0%";
    document.getElementById("invoiceCheckmark").classList.remove("show");
  }

  function hideInvoiceProcessingOverlay() {
    document.getElementById("invoice-overlay").classList.remove("show");
    document.body.style.overflow = "auto";
    clearInterval(invoiceProgressInterval);
  }

  function startInvoiceProcessingProgress() {
    const bar = document.getElementById("invoiceProgressBar");
    const text = document.getElementById("invoiceProgressText");

    clearInterval(invoiceProgressInterval);
    invoiceProgress = 0;
    bar.style.width = "0%";
    text.innerText = "0%";

    invoiceProgressInterval = setInterval(() => {
      if (invoiceProgress >= 96) return; // cap to 96% to allow final bump

      const increment = Math.random() * 3 + 1.5;
      invoiceProgress = Math.min(invoiceProgress + increment, 96);

      bar.style.width = `${invoiceProgress}%`;
      text.innerText = `${Math.round(invoiceProgress)}%`;
    }, 250);
  }

  function completeInvoiceProcessingProgress() {
    clearInterval(invoiceProgressInterval);

    const bar = document.getElementById("invoiceProgressBar");
    const text = document.getElementById("invoiceProgressText");
    const check = document.getElementById("invoiceCheckmark");

    bar.style.width = "100%";
    text.innerText = "";
    check.classList.add("show");

    setTimeout(() => {
      hideInvoiceProcessingOverlay();
    }, 3000);
  }

function updateInvoiceSteps() {
  const steps = [
    { msg: "‚è≥ Preparing Invoice...", delay: 1500 },
    { msg: "üì§ Sending to WhatsApp & Email...", delay: 2000 },
    { msg: "üîê Verifying delivery status...", delay: 1500 }
  ];

  let index = 0;

  function nextStep() {
    if (index >= steps.length) return;

    const step = steps[index];
    document.getElementById("invoice-overlay-message").innerText = step.msg;

    index++;
    setTimeout(nextStep, step.delay);
  }

  // Delay start by 300ms to avoid overwrite by immediate message
  setTimeout(nextStep, 300);
}


function launchConfetti() {
  const canvas = document.getElementById("invoice-confetti-canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const particles = Array.from({ length: 150 }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height - canvas.height,
    size: Math.random() * 8 + 4,
    color: `hsl(${Math.random() * 360}, 100%, 60%)`,
    velocity: Math.random() * 3 + 2,
    angle: Math.random() * Math.PI * 2,
    spin: Math.random() * 0.2 - 0.1
  }));

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (const p of particles) {
      p.y += p.velocity;
      p.angle += p.spin;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.angle);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
      ctx.restore();

      if (p.y > canvas.height) p.y = -10;
    }

    requestAnimationFrame(draw);
  }

  draw();

  setTimeout(() => {
    canvas.width = 1;
    canvas.height = 1;
  }, 3000); // Auto-stop after 3 seconds
}
</script>

<script>
// ‚úÖ Returns ISO format with +05:30 offset for saving
function getISTTimestampISO() {
  const now = new Date();
  const istOffset = 330; // IST is +5:30 in minutes
  const istTime = new Date(now.getTime() + istOffset * 60000);
  const iso = istTime.toISOString().slice(0, -1); // Remove trailing Z
  return `${iso}+05:30`;
}

// ‚úÖ Converts ISO string with +05:30 back to readable format
function formatISTDate(isoStr) {
  const date = new Date(isoStr.replace('+05:30', 'Z')); // Convert back for parsing
  const options = {
    day: "numeric",
    month: "short",
    year: "numeric",
    hour: "numeric",
    minute: "2-digit",
    hour12: true,
    timeZone: "Asia/Kolkata"
  };
  return date.toLocaleString("en-IN", options);
}
</script>



  <div id="details-modal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeDetailsModal()">&times;</span>
      <h2 id="modal-title"></h2>
      <p id="modal-description"></p>
    </div>
  </div>

  <!-- üåü Modern Product Modal -->
  <div id="product-details-modal" class="modern-modal-overlay">
    <div class="modern-modal two-column-layout">
      <button class="modern-close-btn" onclick="closeProductModal()">√ó</button>

      <!-- Left: Product Image -->
      <div class="modern-left">
        <img id="modal-product-img" class="modern-product-img" src="" alt="Product Preview" />

        <div id="modal-product-pricing" class="modal-price-block"></div>
      </div>

      <!-- Right: Info Area -->
      <div class="modern-right">
        <h2 id="modal-product-name" class="modern-product-name"></h2>



        <div id="modal-product-desc" class="modern-description"></div>

        <div class="modern-cta">
          <button id="modal-buy-btn" class="modern-buy-btn">üõí Buy Now</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup Notification -->
  <div id="popup" class="popup"></div>

  <!-- Include the Popup Script -->
  <script src="assets/estore/popup.js"></script>

  <!-- That script likely injects something like this dynamically: -->
  <div id="recent-purchase-popup" class="purchase-alert"></div>




  <!-- üî• Flash Deals (Ticker Floating Widget) -->
  <div id="flash-deals-ticker" class="fd-ticker">
    <div class="fd-ticker-content">Loading deals...</div>
  </div>
  <script src="assets/estore/flash-ticker.js" defer></script>



  <!-- Invoice Progress Overlay -->

  <div id="invoice-overlay" class="invoice-overlay">
    <div class="invoice-overlay-content">
      <div class="invoice-spinner"></div>
      <h2 id="invoice-overlay-title">Processing...</h2>
      <p id="invoice-overlay-message">Please wait...</p>
      <div class="invoice-progress-bar">
        <div id="invoiceProgressBar" class="invoice-progress"></div>
      </div>
      <div id="invoiceProgressText" class="invoice-progress-text">0%</div>
      <div id="invoiceCheckmark" class="invoice-checkmark">‚úÖ</div>
    </div>
  </div>
  <canvas id="invoice-confetti-canvas" style="position: fixed; top: 0; left: 0; pointer-events: none; z-index: 10000;"></canvas>


  <!-- Back to Top Button -->
  <button id="backToTop" class="back-to-top" aria-label="Back to Top" data-tooltip="Back to Top">‚¨ÜÔ∏è</button>

  <div id="scrollProgress"></div>



</body>

</html>