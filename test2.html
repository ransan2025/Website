<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multi-Step Enquiry Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="assets/enquiry/enquiry.css" rel="stylesheet">
</head>

<body>

  <header style="display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background: #fff; border-bottom: 1px solid #eee; box-shadow: 0 2px 6px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;">
    <div style="display: flex; align-items: center;">
      <img src="https://www.ransangroups.com/images/logo.png" alt="RanSan Logo" style="height: 40px; margin-right: 10px;">
      <h1 style="margin: 0; font-size: 20px; color: #9a22f6;">RanSan Groups</h1>
    </div>
    <nav>
      <a href="/" style="margin: 0 12px; color: #333; text-decoration: none; font-weight: 500;">Home</a>
      <a href="/about.html" style="margin: 0 12px; color: #333; text-decoration: none; font-weight: 500;">About</a>
      <a href="/services.html" style="margin: 0 12px; color: #333; text-decoration: none; font-weight: 500;">Services</a>
      <a href="/contact.html" style="margin: 0 12px; color: #9a22f6; font-weight: bold; text-decoration: none;">Contact</a>
    </nav>
  </header>

  <div class="form-container">
    <ul class="form-progressbar">
      <li class="active"></li>
      <li></li>
      <li></li>
    </ul>

    <form id="enquiryForm" onsubmit="submitForm(event)">
      <div class="form-step active" id="step1">
        <div class="form-group">
          <label for="mainService">Select Service</label>
          <select id="mainService" name="mainService" required>
            <option value="">-- Choose Service --</option>
            <option value="Technology">Technology</option>
            <option value="Digital Marketing">Digital Marketing</option>
            <option value="Event Management">Event Management</option>
            <option value="Real Estate">Real Estate</option>
            <option value="Online">Online</option>
            <option value="Private Financing">Private Financing</option>
            <option value="Stocks">Stocks</option>
            <option value="Mutual Fund">Mutual Fund</option>
          </select>
        </div>

        <div class="form-group" id="subServiceContainer"></div>

        <div class="btn-group">
          <button type="button" id="next1">Next</button>
        </div>
      </div>

      <div class="form-step" id="step2"></div>

      <div class="form-step" id="step3"></div>
    </form>
  </div>

  <footer style="text-align:center; padding: 20px; color:#888; font-size: 14px;">
    &copy; 2025 <strong>RanSan Groups</strong>. All rights reserved. | Contact: <a href="mailto:support@ransangroups.com" style="color:#9a22f6;">support@ransangroups.com</a>
  </footer>

  <script>
    // Your existing variables & step2Fields should be here (keep them as is)
    // I'm only showing the fixed parts below for brevity

    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const next1 = document.getElementById('next1');
    const mainService = document.getElementById('mainService');
    const subServiceContainer = document.getElementById('subServiceContainer');

    // Your servicesWithSub, nestedSubServices and step2Fields stay as is

    mainService.addEventListener('change', e => {
      const selected = e.target.value;
      subServiceContainer.innerHTML = '';

      if (servicesWithSub[selected]) {
        const label = document.createElement('label');
        label.textContent = 'Select Sub-Service';
        const select = document.createElement('select');
        select.id = 'subService';
        select.name = 'subService';
        select.required = true;

        select.innerHTML = '<option value="">-- Choose --</option>' +
          servicesWithSub[selected].map(option => `<option value="${option}">${option}</option>`).join('');

        subServiceContainer.appendChild(label);
        subServiceContainer.appendChild(select);

        if (selected === 'Real Estate') {
          select.addEventListener('change', ev => {
            const nested = nestedSubServices[ev.target.value];
            document.querySelector("#nestedSubService")?.remove();

            if (nested) {
              const subLabel = document.createElement('label');
              subLabel.textContent = 'Select Specific Real Estate Service';
              const subSelect = document.createElement('select');
              subSelect.id = 'nestedSubService';
              subSelect.name = 'nestedSubService';
              subSelect.required = true;
              subSelect.innerHTML = '<option value="">-- Choose --</option>' +
                nested.map(opt => `<option value="${opt}">${opt}</option>`).join('');

              subServiceContainer.appendChild(subLabel);
              subServiceContainer.appendChild(subSelect);
            }
          });
        }
      }
    });

    next1.addEventListener('click', () => {
      const selectedService = mainService.value;
      const subServiceElem = document.getElementById('subService');
      const nestedSubServiceElem = document.getElementById('nestedSubService');

      const subService = subServiceElem?.value;
      const nested = nestedSubServiceElem?.value;

      let key = selectedService;

      if (!selectedService) return alert("Please select a service.");

      if (selectedService === "Real Estate") {
        if (!subService) return alert("Please select a sub-service.");
        if (nestedSubServiceElem && !nested) return alert("Please select specific Real Estate service.");
        key = nested || subService;
      } else if (subService) {
        key = subService;
      }

      const rawHtml = step2Fields[key];
      if (!rawHtml) return alert("Step 2 form not found for selected service.");

      const wrappedFields = wrapFieldsInFormGroup(rawHtml);

      step2.innerHTML = `
        ${wrappedFields}
        <div class="btn-group">
          <button type="button" onclick="backToStep(1)">Back</button>
          <button type="button" onclick="nextToStep3()">Next</button>
        </div>`;

      goToStep(2);
    });

    function nextToStep3() {
      const step3Html = getStep3HTML();
      step3.innerHTML = `
        ${step3Html}
        <div class="btn-group">
          <button type="button" onclick="backToStep(2)">Back</button>
          <button type="submit">Submit</button>
        </div>`;
      goToStep(3);
    }

    function goToStep(stepNum) {
      [step1, step2, step3].forEach((s, i) => {
        s.classList.toggle('active', i === stepNum - 1);
      });
    }

    function backToStep(stepNum) {
      goToStep(stepNum);
    }

    function getStep3HTML() {
      return `
      <div class="form-grid">
        <div class="form-group">
          <label>Name</label>
          <input type="text" name="name" required />
        </div>
        <div class="form-group">
          <label>Mobile Number</label>
          <input type="tel" name="mobile" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" required />
        </div>
        <div class="form-group">
          <label>Preferred Contact Method</label>
          <select name="contactMethod" required>
            <option value="Phone">Phone</option>
            <option value="Email">Email</option>
            <option value="WhatsApp">WhatsApp</option>
          </select>
        </div>
        <div class="form-group" style="grid-column: span 2;">
          <label>Remark</label>
          <textarea name="remark" rows="3"></textarea>
        </div>
      </div>`;
    }

    function wrapFieldsInFormGroup(rawHtml) {
      const wrapper = document.createElement('div');
      wrapper.innerHTML = rawHtml;

      const grid = document.createElement('div');
      grid.className = 'form-grid';

      const children = Array.from(wrapper.children);

      for (let i = 0; i < children.length; i++) {
        const node = children[i];
        if (node.tagName === 'LABEL') {
          const group = document.createElement('div');
          group.className = 'form-group';
          group.appendChild(node);
          const nextNode = children[i + 1];
          if (nextNode && (nextNode.tagName === 'INPUT' || nextNode.tagName === 'SELECT' || nextNode.tagName === 'TEXTAREA' || nextNode.tagName === 'DIV')) {
            group.appendChild(nextNode);
            i++;
          }
          grid.appendChild(group);
        }
      }
      return grid.outerHTML;
    }

    async function submitForm(event) {
      event.preventDefault();
      const formData = new FormData(document.getElementById("enquiryForm"));
      const data = {};
      formData.forEach((value, key) => {
        if (data[key]) {
          if (Array.isArray(data[key])) {
            data[key].push(value);
          } else {
            data[key] = [data[key], value];
          }
        } else {
          data[key] = value;
        }
      });

      try {
        const response = await fetch(
          "https://script.google.com/macros/s/AKfycbzXc5cLjhHkHAHd7WrIfP_SQ7TUgIQJjAOo_ZeWKv5a2EBsg_uGqY_6w8HK4D0M3Ew3/exec",
          {
            method: "POST",
            body: JSON.stringify(data),
            headers: { "Content-Type": "application/json" }
          }
        );

        const result = await response.json();

        if (result.success) {
          alert("Your enquiry has been submitted successfully.");
          window.location.reload();
        } else {
          alert("Submission failed: " + result.error);
        }
      } catch (err) {
        alert("Error submitting form: " + err.message);
      }
    }
  </script>

</body>

</html>
